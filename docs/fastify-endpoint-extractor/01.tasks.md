# タスクリスト: Fastify Endpoint Extractor

Updated: 2025/12/29 21:50

## 復旧手順

このファイルを読み込んだ場合、以下を実行:
1. 下記のTodo一覧をTodoWriteで設定
2. in_progressのタスクから作業再開
3. 該当タスクの詳細セクションを参照

---

## Todo一覧（TodoWrite用）

| # | タスク | 状態 | 進行形 |
|---|--------|------|--------|
| 1 | ts-morph, yamlパッケージをインストール | pending | パッケージをインストールしている |
| 2 | EndpointInfo型を定義する | pending | EndpointInfo型を定義している |
| 3 | RouteRegistration型を定義する | pending | RouteRegistration型を定義している |
| 4 | ExtractedEndpoints型を定義する | pending | ExtractedEndpoints型を定義している |
| 5 | BuildFileParser用テストを作成する | pending | BuildFileParser用テストを作成している |
| 6 | RouteFileParser用テストを作成する | pending | RouteFileParser用テストを作成している |
| 7 | TypeExtractor用テストを作成する | pending | TypeExtractor用テストを作成している |
| 8 | YamlGenerator用テストを作成する | pending | YamlGenerator用テストを作成している |
| 9 | BuildFileParserを実装する | pending | BuildFileParserを実装している |
| 10 | RouteFileParserを実装する | pending | RouteFileParserを実装している |
| 11 | TypeExtractorを実装する | pending | TypeExtractorを実装している |
| 12 | YamlGeneratorを実装する | pending | YamlGeneratorを実装している |
| 13 | CLIエントリーポイントを実装する | pending | CLIエントリーポイントを実装している |
| 14 | 実プロジェクトでテスト実行する | pending | 実プロジェクトでテスト実行している |

---

## タスク詳細

### タスク1: ts-morph, yamlパッケージをインストール

**状態**: pending
**参照設計書**: [00.index.md](./00.index.md#依存関係)

**作業内容**:
1. `bun add ts-morph yaml` を実行
2. package.jsonに追加されたことを確認

**担当ファイル**:
- `package.json`
- `bun.lock`

**完了条件**:
- [ ] ts-morphがインストールされている
- [ ] yamlがインストールされている

---

### タスク2: EndpointInfo型を定義する

**状態**: pending
**参照設計書**: [02.models.md](./02.models.md#endpoint-info)

**作業内容**:
1. `src/types/endpoint.ts` を作成
2. EndpointInfo型を定義
3. HTTPメソッド型を定義

**担当ファイル**:
- `src/types/endpoint.ts`

**完了条件**:
- [ ] 型定義が設計書と一致
- [ ] エクスポートされている

---

### タスク3: RouteRegistration型を定義する

**状態**: pending
**参照設計書**: [02.models.md](./02.models.md#route-registration)

**作業内容**:
1. `src/types/route.ts` を作成
2. RouteRegistration型を定義
3. ルートファイル情報を保持する型を定義

**担当ファイル**:
- `src/types/route.ts`

**完了条件**:
- [ ] 型定義が設計書と一致
- [ ] エクスポートされている

---

### タスク4: ExtractedEndpoints型を定義する

**状態**: pending
**参照設計書**: [02.models.md](./02.models.md#extracted-endpoints)

**作業内容**:
1. `src/types/output.ts` を作成
2. ExtractedEndpoints型を定義
3. YAML出力用の構造を定義

**担当ファイル**:
- `src/types/output.ts`

**完了条件**:
- [ ] 型定義が設計書と一致
- [ ] YAML出力形式と整合している

---

### タスク5: BuildFileParser用テストを作成する

**状態**: pending
**参照設計書**: [03.tests.md](./03.tests.md#build-file-parser)

**作業内容**:
1. `src/__tests__/buildFileParser.test.ts` を作成
2. 正常系: app.register解析テスト
3. 正常系: 複数ルート登録の解析テスト
4. 異常系: 不正な形式のテスト

**担当ファイル**:
- `src/__tests__/buildFileParser.test.ts`

**完了条件**:
- [ ] 設計書の全テストケースが実装されている
- [ ] テストが実行可能（FAILするのが正常）

---

### タスク6: RouteFileParser用テストを作成する

**状態**: pending
**参照設計書**: [03.tests.md](./03.tests.md#route-file-parser)

**作業内容**:
1. `src/__tests__/routeFileParser.test.ts` を作成
2. 正常系: GET/POST/PUT/DELETE/PATCH解析テスト
3. 正常系: ジェネリック型パラメータ解析テスト
4. 正常系: パスパラメータ抽出テスト

**担当ファイル**:
- `src/__tests__/routeFileParser.test.ts`

**完了条件**:
- [ ] 設計書の全テストケースが実装されている
- [ ] テストが実行可能（FAILするのが正常）

---

### タスク7: TypeExtractor用テストを作成する

**状態**: pending
**参照設計書**: [03.tests.md](./03.tests.md#type-extractor)

**作業内容**:
1. `src/__tests__/typeExtractor.test.ts` を作成
2. 正常系: 型リテラルからプロパティ抽出
3. 正常系: 型参照の解決
4. 正常系: オプショナルプロパティの扱い

**担当ファイル**:
- `src/__tests__/typeExtractor.test.ts`

**完了条件**:
- [ ] 設計書の全テストケースが実装されている
- [ ] テストが実行可能（FAILするのが正常）

---

### タスク8: YamlGenerator用テストを作成する

**状態**: pending
**参照設計書**: [03.tests.md](./03.tests.md#yaml-generator)

**作業内容**:
1. `src/__tests__/yamlGenerator.test.ts` を作成
2. 正常系: 単一エンドポイントのYAML出力
3. 正常系: 複数エンドポイントのYAML出力
4. 正常系: ネストされたパスの出力

**担当ファイル**:
- `src/__tests__/yamlGenerator.test.ts`

**完了条件**:
- [ ] 設計書の全テストケースが実装されている
- [ ] テストが実行可能（FAILするのが正常）

---

### タスク9: BuildFileParserを実装する

**状態**: pending
**参照設計書**: [04.parser-implementation.md](./04.parser-implementation.md#build-file-parser)

**作業内容**:
1. `src/parsers/buildFileParser.ts` を作成
2. app.register呼び出しを検出
3. ルートモジュール名とprefixを抽出
4. importパスからルートファイルパスを解決

**担当ファイル**:
- `src/parsers/buildFileParser.ts`

**完了条件**:
- [ ] タスク5のテストが全てパスする
- [ ] エラーハンドリングが適切

---

### タスク10: RouteFileParserを実装する

**状態**: pending
**参照設計書**: [04.parser-implementation.md](./04.parser-implementation.md#route-file-parser)

**作業内容**:
1. `src/parsers/routeFileParser.ts` を作成
2. server.get/post/put/delete/patch呼び出しを検出
3. パス文字列を抽出
4. ジェネリック型パラメータを抽出

**担当ファイル**:
- `src/parsers/routeFileParser.ts`

**完了条件**:
- [ ] タスク6のテストが全てパスする
- [ ] 全HTTPメソッドに対応

---

### タスク11: TypeExtractorを実装する

**状態**: pending
**参照設計書**: [04.parser-implementation.md](./04.parser-implementation.md#type-extractor)

**作業内容**:
1. `src/parsers/typeExtractor.ts` を作成
2. 型リテラルからプロパティ名と型を抽出
3. 型参照を解決して実際の型定義を取得
4. オプショナル/必須の判定

**担当ファイル**:
- `src/parsers/typeExtractor.ts`

**完了条件**:
- [ ] タスク7のテストが全てパスする
- [ ] 型参照の解決ができる

---

### タスク12: YamlGeneratorを実装する

**状態**: pending
**参照設計書**: [05.yaml-output.md](./05.yaml-output.md)

**作業内容**:
1. `src/generators/yamlGenerator.ts` を作成
2. ExtractedEndpointsをYAML形式に変換
3. インデントとフォーマットの調整
4. ファイル出力機能

**担当ファイル**:
- `src/generators/yamlGenerator.ts`

**完了条件**:
- [ ] タスク8のテストが全てパスする
- [ ] 出力形式が設計書と一致

---

### タスク13: CLIエントリーポイントを実装する

**状態**: pending
**参照設計書**: [04.parser-implementation.md](./04.parser-implementation.md#cli-entry)

**作業内容**:
1. `index.ts` を実装
2. コマンドライン引数の解析
3. 各パーサーの呼び出し
4. 結果の出力

**担当ファイル**:
- `index.ts`

**完了条件**:
- [ ] コマンドライン引数でプロジェクトパスを受け取れる
- [ ] YAML出力ができる

---

### タスク14: 実プロジェクトでテスト実行する

**状態**: pending
**参照設計書**: なし

**作業内容**:
1. voice-app-test/serverプロジェクトで実行
2. 出力結果を検証
3. 不足している機能があれば追加

**担当ファイル**:
- なし（テスト実行のみ）

**完了条件**:
- [ ] 実プロジェクトで正常に動作する
- [ ] 全エンドポイントが抽出される
