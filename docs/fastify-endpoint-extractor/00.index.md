# Fastify Endpoint Extractor - AST解析ツール

Updated: 2025/12/29 21:50

## 概要

TypeScript ASTを使用してFastifyプロジェクトのエンドポイント定義を解析し、
YAML形式で出力するコマンドラインツール。

### 目的

- Fastifyプロジェクトの全エンドポイントを自動で抽出
- APIドキュメント生成の基盤として活用
- エンドポイントの棚卸し・レビューに使用

### ユースケース

1. 新規参加者がAPIの全体像を把握する
2. API仕様書の自動生成
3. フロントエンドとの型共有の基盤

## 目次

1. [タスクリスト](./01.tasks.md) - コンテキスト復旧用
2. [モデル/データ型設計](./02.models.md) - 型定義
3. [テスト設計](./03.tests.md) - テストケース
4. [パーサー実装設計](./04.parser-implementation.md) - AST解析ロジック
5. [YAML出力設計](./05.yaml-output.md) - 出力フォーマット

## スコープ

### 対象

- Fastifyのルート登録パターン（`app.register(Routes, { prefix })`）
- HTTPメソッド定義（`server.get/post/put/delete/patch`）
- ジェネリック型パラメータ（`Params`, `Querystring`, `Body`）
- 型リテラルおよび型参照の解析

### 対象外

- Socket.IOイベントハンドラ
- ミドルウェアの詳細解析
- レスポンス型の解析（将来拡張）
- 動的ルート生成パターン

## 前提条件

- Bun 1.0以上
- TypeScriptプロジェクト
- ts-morphライブラリ

## 依存関係

| パッケージ | バージョン | 用途 |
|-----------|-----------|------|
| ts-morph | ^23.0.0 | TypeScript AST解析 |
| yaml | ^2.3.0 | YAML出力 |

## 実装フェーズ

| Phase | 内容 | 担当設計書 |
|-------|------|-----------|
| 1 | データ型定義 | 02.models.md |
| 2 | テスト作成 | 03.tests.md |
| 3 | build.ts解析 | 04.parser-implementation.md |
| 4 | ルートファイル解析 | 04.parser-implementation.md |
| 5 | YAML出力 | 05.yaml-output.md |

## 入出力例

### 入力

```
bun run index.ts /path/to/fastify-project
```

### 出力（YAML）

```yaml
/users:
  endpoints:
    /:id:
      METHOD: GET
      pathParams:
        id: string
    /initialize:
      METHOD: POST
      bodyParams:
        uid: string
        code: string | undefined
        forceRegister: boolean | undefined
    /followers:
      METHOD: GET
      queryParams:
        id: string
        next: string | undefined
```

## アーキテクチャ概要

```
index.ts (CLI エントリーポイント)
    │
    ├── BuildFileParser
    │   └── build.tsを解析してルート登録情報を抽出
    │
    ├── RouteFileParser
    │   └── 各ルートファイルを解析してエンドポイント情報を抽出
    │
    ├── TypeExtractor
    │   └── ジェネリック型パラメータから型情報を抽出
    │
    └── YamlGenerator
        └── 解析結果をYAML形式で出力
```
